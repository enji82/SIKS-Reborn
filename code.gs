/**
 * ===================================================================
 * ======================= 1. KONFIGURASI PUSAT ======================
 * ===================================================================
 */
const SPREADSHEET_IDS = {
  SK_DATA: "1AmvOJAhOfdx09eT54x62flWzBZ1xNQ8Sy5lzvT9zJA4",
  
  // INI ID DATABASE USER (Yang Bapak Konfirmasi Benar)
  DROPDOWN_DATA: "1wiDKez4rL5UYnpP2-OZjYowvmt1nRx-fIMy9trJlhBA", 
  
  // ID Lainnya (Tetap kita simpan agar fitur lain tidak rusak)
  PAUD_DATA: "1an0oQQPdMh6wrUJIAzTGYk3DKFvYprK5SU7RmRXjIgs",
  SD_DATA: "1u4tNL3uqt5xHITXYwHnytK6Kul9Siam-vNYuzmdZB4s",
  LAPBUL_GABUNGAN: "1aKEIkhKApmONrCg-QQbMhXyeGDJBjCZrhR-fvXZFtJU",
  PTK_PAUD_DB: "1XetGkBymmN2NZQlXpzZ2MQyG0nhhZ0sXEPcNsLffhEU",
  PTK_SD_DB: "1HlyLv3Ai3_vKFJu3EKznqI9v8g0tfqiNg0UbIojNMQ0",
  DATA_SEKOLAH: "1qeOYVfqFQdoTpysy55UIdKwAJv3VHo4df3g6u6m72Bs",   
  FORM_OPTIONS_DB: "1prqqKQBYzkCNFmuzblNAZE41ag9rZTCiY2a0WvZCTvU",
  SIABA_REKAP: "1x3b-yzZbiqP2XfJNRC3XTbMmRTHLd8eEdUqAlKY3v9U",
  SIABA_TIDAK_PRESENSI: "1mjXz5l_cqBiiR3x9qJ7BU4yQ3f0ghERT9ph8CC608Zc",
  SIABA_DB: "1sfbvyIZurU04gictep8hI-NnvicGs0wrDqANssVXt6o",
  SIABA_SALAH_DB: "1TZGrMiTuyvh2Xbo44RhJuWlQnOC5LzClsgIoNKtRFkY",
  SIABA_DINAS_DB: "1I_2yUFGXnBJTCSW6oaT3D482YCs8TIRkKgQVBbvpa1M",
  SIABA_CUTI_DB: "1DhBjmLHFMuJqWM6yJHsm-1EKvHzG8U4zK2GuU-dIgn8",
  SIABA_REKAP_HELPER: "1wiDKez4rL5UYnpP2-OZjYowvmt1nRx-fIMy9trJlhBA",
  SIABA_SKP_SOURCE: "1ReJt2qoDE2f_8LeR8DXJbROB9EAHK8qP2kYp-ZZ3V9w", 
  SIABA_SKP_DB: "1T-AQ0jYJ_jXYEPxzu_KZauOlRTTforVtFEZ_1UrWHwk",
  SIABA_PNS_DB: "1wiDKez4rL5UYnpP2-OZjYowvmt1nRx-fIMy9trJlhBA",
  SIABA_PAK_DB: "1mAXwf7cHaOqIj2uf51Fup5tyyBzijTeIxVS8uO1E4dM",
};

const FOLDER_CONFIG = {
  MAIN_SK: "1GwIow8B4O1OWoq3nhpzDbMO53LXJJUKs", 
  LAPBUL_KB: "18CxRT-eledBGRtHW1lFd2AZ8Bub6q5ra",
  LAPBUL_TK: "1WUNz_BSFmcwRVlrG67D2afm9oJ-bVI9H",
  LAPBUL_SD: "1I8DRQYpBbTt1mJwtD1WXVD6UK51TC8El",
  SIABA_LUPA: "10kwGuGfwO5uFreEt7zBJZUaDx1fUSXo9",
  SIABA_DINAS: "1uPeOU7F_mgjZVyOLSsj-3LXGdq9rmmWl",
  SIABA_CUTI_DOCS: "1fAmqJXpmGIfEHoUeVm4LjnWvnwVwOfNM",
  SIABA_REKAP_ARCHIVE: "1MoGuseJNrOIMnkZNoqkKcK282jZpUkAm",
  SIABA_SKP_DOCS: "1DGYC8AtJFCpCZ0ou2ae9-5fc2-bWl20G",
  SIABA_PAK_DOCS: "1cvn-pOufs-OIbFQfqhmxc3fcmFuox4Sc",
};


/**
 * ===================================================================
 * ===================== 2. FUNGSI DASAR WEB =========================
 * ===================================================================
 */

// Menampilkan Halaman Utama (index.html)
function doGet() {
  return HtmlService.createTemplateFromFile('index')
      .evaluate() 
      .setTitle('SIKS - REBORN')
      .addMetaTag('viewport', 'width=device-width, initial-scale=1')
      .setXFrameOptionsMode(HtmlService.XFrameOptionsMode.ALLOWALL);
}

/**
 * Fungsi Include (DIPERBAIKI)
 * Menggunakan createTemplate agar kode CSS/JS di dalam file pecahan 
 * diproses dengan benar (menghilangkan teks mentah <?!= include ?>)
 */
function include(filename) {
  try {
    return HtmlService.createTemplateFromFile(filename).evaluate().getContent();
  } catch (e) {
    // Jika gagal sebagai template, coba sebagai HTML biasa
    return HtmlService.createHtmlOutputFromFile(filename).getContent();
  }
}

/**
 * FUNGSI PEMANGGIL HALAMAN (ROUTING)
 * pageName adalah nama file (tanpa 'page_') yang dikirim oleh muatHalaman()
 */
function getPageContent(pageName) {
  if (!pageName) return "<h3>Error: Nama halaman kosong</h3>";

  // Pastikan format file selalu: page_namafile
  var cleanName = pageName.toString().replace(/^page_/, ''); 
  var fileName = 'page_' + cleanName; 
  
  try {
    // WAJIB ADA .evaluate() agar isi file (yang mungkin ada include lagi) dimasak dulu
    return HtmlService.createTemplateFromFile(fileName).evaluate().getContent();
  } catch (e) {
    return "<div style='color:red; padding:20px; background:rgba(255,0,0,0.1); border-radius:8px;'>" +
           "<h3><i class='fas fa-exclamation-triangle'></i> File Tidak Ditemukan</h3>" +
           "<p>Sistem mencari file <b>" + fileName + ".html</b> tapi tidak ada.</p></div>";
  }
}

// Bantuan URL untuk Script (Opsional)
function getScriptUrl() { return ScriptApp.getService().getUrl(); }


/**
 * ===================================================================
 * ===================== 3. FUNGSI LOGIN (SUKSES) ====================
 * ===================================================================
 */

function doLogin(form) {
  try {
    var username = form.username;
    var password = form.password;
    
    // Pastikan SPREADSHEET_IDS.DROPDOWN_DATA sudah didefinisikan di bagian KONFIGURASI PUSAT
    var ss = SpreadsheetApp.openById(SPREADSHEET_IDS.DROPDOWN_DATA);
    var sheet = ss.getSheetByName('Data User'); 
    
    if (!sheet) {
      return { status: 'error', message: 'Tab "Data User" tidak ditemukan di Spreadsheet.' };
    }

    var data = sheet.getDataRange().getDisplayValues();
    
    // Loop User (Mulai baris 2 untuk melewati header)
    for (var i = 1; i < data.length; i++) {
      var row = data[i];
      // Cek apakah Username (Kolom A) dan Password (Kolom B) cocok
      if (String(row[0]).trim() == username && String(row[1]).trim() == password) {
        
        // Kirim balik data user ke browser untuk disimpan sebagai sesi
        return {
          status: 'success',
          data: {
            username: row[0],
            nama: row[2] || row[0], // Ambil Nama Lengkap (Kolom C)
            role: row[3] || 'User'  // Ambil Role (Kolom D)
          }
        };
      }
    }

    return { status: 'error', message: 'Username atau Password salah.' };

  } catch (e) {
    return { status: 'error', message: 'Error System: ' + e.message };
  }
}


/**
 * ===================================================================
 * ===================== 4. MODUL: DATA SK (DATA) ====================
 * ===================================================================
 */

// A. PROSES UNGGAH SK
function processManualForm(form) {
  try {
    var folder = DriveApp.getFolderById(FOLDER_CONFIG.MAIN_SK); // Pakai Config Folder Bapak
    var fileUrl = "#"; 

    if (form.fileData && form.fileData.data) {
       var blob = Utilities.newBlob(Utilities.base64Decode(form.fileData.data), form.fileData.mimeType, form.fileData.name);
       var file = folder.createFile(blob);
       file.setSharing(DriveApp.Access.ANYONE_WITH_LINK, DriveApp.Permission.VIEW);
       fileUrl = file.getUrl();
    }

    var ss = SpreadsheetApp.openById(SPREADSHEET_IDS.SK_DATA); // Pakai ID SK Data Bapak
    var sheet = ss.getSheetByName("Unggah_SK"); 
    
    // Format Tanggal
    var tglSKFormatted = form.tanggalSK;
    if(form.tanggalSK && form.tanggalSK.includes('-')){
       var parts = form.tanggalSK.split('-');
       tglSKFormatted = parts[2] + '/' + parts[1] + '/' + parts[0];
    }

    sheet.appendRow([
      "'" + form.nomorSK, form.namaSD, form.tahunAjaran, form.semester,
      tglSKFormatted, form.kriteriaSK, fileUrl, "Diproses", 
      new Date(), form.userInput, 
      "", "", "", "", "" 
    ]);

    return "Data berhasil dikirim.";
  } catch (e) { return "Error Upload: " + e.message; }
}

// B. AMBIL DATA SK (Tabel)
function getSKData() {
  try {
    var ss = SpreadsheetApp.openById(SPREADSHEET_IDS.SK_DATA);
    var sheet = ss.getSheetByName("Unggah_SK");
    var isAdmin = true; 

    var data = sheet.getDataRange().getDisplayValues();
    if (data.length <= 1) return { rows: [], isAdmin: isAdmin };

    var headers = data[0];
    var rows = data.slice(1);
    
    // Helper Cari Kolom
    function findCol(candidates) {
      for (var i = 0; i < candidates.length; i++) {
        var target = candidates[i].toLowerCase();
        for (var j = 0; j < headers.length; j++) {
           if (headers[j].toString().toLowerCase().trim() === target) return j;
        }
      }
      return -1; 
    }

    var idx = {
      noSK: findCol(["Nomor SK", "No SK"]),
      namaSD: findCol(["Nama Sekolah", "Nama SD"]),
      tahun: findCol(["Tahun Ajaran", "Tahun"]),
      sem: findCol(["Semester"]),
      tglSK: findCol(["Tanggal SK"]),
      kriteria: findCol(["Kriteria SK"]),
      dok: findCol(["Link File", "Dokumen"]),
      status: findCol(["Status"]),
      tglUpload: findCol(["Timestamp", "Tanggal Unggah"]),
      userInput: findCol(["User Input"]),
      update: findCol(["Update"]),
      userUpdate: findCol(["User Update"]),
      verval: findCol(["Verval"]),
      verifikator: findCol(["Verifikator"]),
      ket: findCol(["Keterangan"])
    };

    var result = rows.map(function(row, i) {
      var v = function(c) { return (c > -1 && row[c]) ? row[c] : '-'; };
      var cleanDate = function(d) { return (d !== '-') ? d.split(' ')[0] : '-'; };
      
      return {
        rowIndex: i + 1, 
        noSK: v(idx.noSK), namaSD: v(idx.namaSD), tahun: v(idx.tahun),
        sem: v(idx.sem), tglSK: v(idx.tglSK), kriteria: v(idx.kriteria),
        dok: v(idx.dok) === '-' ? '#' : v(idx.dok),
        status: (idx.status > -1 && row[idx.status]) ? row[idx.status] : 'Diproses',
        tglUpload: cleanDate(v(idx.tglUpload)), userInput: v(idx.userInput),
        update: cleanDate(v(idx.update)), userUpdate: v(idx.userUpdate),
        verval: cleanDate(v(idx.verval)), verifikator: v(idx.verifikator),
        ket: v(idx.ket)
      };
    });

    return { rows: result, isAdmin: isAdmin }; 
  } catch (e) { return { error: "Error Backend: " + e.message }; }
}

// C. PROSES EDIT SK
function processEditSK(form) {
  try {
    var ss = SpreadsheetApp.openById(SPREADSHEET_IDS.SK_DATA);
    var sheet = ss.getSheetByName("Unggah_SK");
    var rowIdx = parseInt(form.rowIndex) + 1; 

    function getColIdx(name) {
      var h = sheet.getRange(1, 1, 1, sheet.getLastColumn()).getValues()[0];
      var ix = h.indexOf(name);
      if(ix < 0 && name == "Nama Sekolah") ix = h.indexOf("Nama SD");
      if(ix < 0 && name == "Link File") ix = h.indexOf("Dokumen");
      return ix + 1;
    }

    if (form.fileData && form.fileData.data) {
       var colFile = getColIdx("Link File");
       var oldUrl = sheet.getRange(rowIdx, colFile).getValue();
       
       var blob = Utilities.newBlob(Utilities.base64Decode(form.fileData.data), form.fileData.mimeType, form.fileData.name);
       var file = DriveApp.getFolderById(FOLDER_CONFIG.MAIN_SK).createFile(blob); // Folder Config Bapak
       file.setSharing(DriveApp.Access.ANYONE_WITH_LINK, DriveApp.Permission.VIEW);
       
       sheet.getRange(rowIdx, colFile).setValue(file.getUrl());
       
       if (oldUrl && oldUrl.length > 10) {
         try { DriveApp.getFileById(oldUrl.match(/[-\w]{25,}/)[0]).setTrashed(true); } catch(e){}
       }
    }

    sheet.getRange(rowIdx, getColIdx("Nomor SK")).setValue(form.nomorSK);
    if(form.tanggalSK) { 
       var p = form.tanggalSK.split('-'); 
       if(p.length===3) sheet.getRange(rowIdx, getColIdx("Tanggal SK")).setValue(p[2]+'/'+p[1]+'/'+p[0]);
    }

    var stCol = getColIdx("Status");
    var oldSt = sheet.getRange(rowIdx, stCol).getValue();
    if(oldSt == 'Revisi' || oldSt == 'Ditolak') sheet.getRange(rowIdx, stCol).setValue('Diproses');

    sheet.getRange(rowIdx, getColIdx("Update")).setValue(new Date());
    sheet.getRange(rowIdx, getColIdx("User Update")).setValue(form.userUpdate);

    return "Data berhasil diperbarui.";
  } catch(e) { return "Error: " + e.message; }
}

// D. PROSES HAPUS SK
function processDeleteSK(form) {
  try {
    var ss = SpreadsheetApp.openById(SPREADSHEET_IDS.SK_DATA);
    var sheetSource = ss.getSheetByName("Unggah_SK");
    var sheetTrash = ss.getSheetByName("Trash_SK");
    if(!sheetTrash) sheetTrash = ss.insertSheet("Trash_SK");

    var rowIdx = parseInt(form.rowIndex) + 1;
    var rowData = sheetSource.getRange(rowIdx, 1, 1, sheetSource.getLastColumn()).getValues()[0];

    rowData.push("Dihapus: " + form.userDelete + ", Alasan: " + form.alasan);
    sheetTrash.appendRow(rowData);
    sheetSource.deleteRow(rowIdx);

    return "Data dipindahkan ke Trash.";
  } catch(e) { return "Error: " + e.message; }
}

function getStatistikPTK() {
  return { total: "156", pns: "85", pppk: "40", honor: "31" };
}


/**
 * ===================================================================
 * ===================== 4. MODUL: DATA SK (FINAL) ===================
 * ===================================================================
 */

// A. PROSES UNGGAH SK
function processManualForm(form) {
  try {
    // 1. Upload File ke Folder MAIN_SK (Sesuai Konfig Bapak)
    var folder = DriveApp.getFolderById(FOLDER_CONFIG.MAIN_SK);
    var fileUrl = "#"; 

    if (form.fileData && form.fileData.data) {
       var blob = Utilities.newBlob(Utilities.base64Decode(form.fileData.data), form.fileData.mimeType, form.fileData.name);
       var file = folder.createFile(blob);
       file.setSharing(DriveApp.Access.ANYONE_WITH_LINK, DriveApp.Permission.VIEW);
       fileUrl = file.getUrl();
    }

    // 2. Simpan ke Spreadsheet SK_DATA
    var ss = SpreadsheetApp.openById(SPREADSHEET_IDS.SK_DATA);
    var sheet = ss.getSheetByName("Unggah_SK"); 
    
    // Format Tanggal SK
    var tglSKFormatted = form.tanggalSK;
    if(form.tanggalSK && form.tanggalSK.includes('-')){
       var parts = form.tanggalSK.split('-');
       tglSKFormatted = parts[2] + '/' + parts[1] + '/' + parts[0];
    }

    // Append Data
    sheet.appendRow([
      "'" + form.nomorSK,
      form.namaSD,
      form.tahunAjaran,
      form.semester,
      tglSKFormatted,
      form.kriteriaSK,
      fileUrl,
      "Diproses", 
      new Date(), 
      form.userInput, 
      "", "", "", "", "" 
    ]);

    return "Data berhasil dikirim.";
  } catch (e) { return "Error Upload: " + e.message; }
}

// B. AMBIL DATA SK (Tabel)
function getSKData() {
  try {
    var ss = SpreadsheetApp.openById(SPREADSHEET_IDS.SK_DATA);
    var sheet = ss.getSheetByName("Unggah_SK");
    var isAdmin = true; 

    var data = sheet.getDataRange().getDisplayValues();
    if (data.length <= 1) return { rows: [], isAdmin: isAdmin };

    var headers = data[0];
    var rows = data.slice(1);
    
    function findCol(candidates) {
      for (var i = 0; i < candidates.length; i++) {
        var target = candidates[i].toLowerCase();
        for (var j = 0; j < headers.length; j++) {
           if (headers[j].toString().toLowerCase().trim() === target) return j;
        }
      }
      return -1; 
    }

    var idx = {
      noSK: findCol(["Nomor SK", "No SK"]),
      namaSD: findCol(["Nama Sekolah", "Nama SD"]),
      tahun: findCol(["Tahun Ajaran", "Tahun"]),
      sem: findCol(["Semester"]),
      tglSK: findCol(["Tanggal SK"]),
      kriteria: findCol(["Kriteria SK"]),
      dok: findCol(["Link File", "Dokumen"]),
      status: findCol(["Status"]),
      tglUpload: findCol(["Timestamp", "Tanggal Unggah"]),
      userInput: findCol(["User Input"]),
      update: findCol(["Update"]),
      userUpdate: findCol(["User Update"]),
      verval: findCol(["Verval"]),
      verifikator: findCol(["Verifikator"]),
      ket: findCol(["Keterangan"])
    };

    var result = rows.map(function(row, i) {
      var v = function(c) { return (c > -1 && row[c]) ? row[c] : '-'; };
      var cleanDate = function(d) { return (d !== '-') ? d.split(' ')[0] : '-'; };
      var parseSort = function(d) {
         if(!d || d==='-') return 0;
         try {
           var p = d.split(' ')[0].split('/'); 
           if(p.length===3) return new Date(p[2], p[1]-1, p[0]).getTime();
           return new Date(d).getTime() || 0;
         } catch(e){ return 0; }
      };
      var sKey = Math.max(parseSort(v(idx.tglUpload)), parseSort(v(idx.update)), parseSort(v(idx.verval)));

      return {
        rowIndex: i + 1, 
        noSK: v(idx.noSK), namaSD: v(idx.namaSD), tahun: v(idx.tahun),
        sem: v(idx.sem), tglSK: v(idx.tglSK), kriteria: v(idx.kriteria),
        dok: v(idx.dok) === '-' ? '#' : v(idx.dok),
        status: (idx.status > -1 && row[idx.status]) ? row[idx.status] : 'Diproses',
        tglUpload: cleanDate(v(idx.tglUpload)), userInput: v(idx.userInput),
        update: cleanDate(v(idx.update)), userUpdate: v(idx.userUpdate),
        verval: cleanDate(v(idx.verval)), verifikator: v(idx.verifikator),
        ket: v(idx.ket), _sortKey: sKey
      };
    });

    result.sort(function(a, b) { return b._sortKey - a._sortKey; });
    return { rows: result, isAdmin: isAdmin }; 
  } catch (e) { return { error: "Error Backend: " + e.message }; }
}

// C. PROSES EDIT SK
function processEditSK(form) {
  try {
    var ss = SpreadsheetApp.openById(SPREADSHEET_IDS.SK_DATA);
    var sheet = ss.getSheetByName("Unggah_SK");
    var rowIdx = parseInt(form.rowIndex) + 1; 

    // Helper Find Col (Local)
    function getColIdx(name) {
      var h = sheet.getRange(1, 1, 1, sheet.getLastColumn()).getValues()[0];
      var ix = h.indexOf(name);
      if(ix < 0 && name == "Nama Sekolah") ix = h.indexOf("Nama SD");
      if(ix < 0 && name == "Link File") ix = h.indexOf("Dokumen");
      return ix + 1;
    }

    // Logic Ganti File (Pakai FOLDER_CONFIG.MAIN_SK)
    if (form.fileData && form.fileData.data) {
       var colFile = getColIdx("Link File");
       var oldUrl = sheet.getRange(rowIdx, colFile).getValue();
       
       var blob = Utilities.newBlob(Utilities.base64Decode(form.fileData.data), form.fileData.mimeType, form.fileData.name);
       var file = DriveApp.getFolderById(FOLDER_CONFIG.MAIN_SK).createFile(blob);
       file.setSharing(DriveApp.Access.ANYONE_WITH_LINK, DriveApp.Permission.VIEW);
       
       sheet.getRange(rowIdx, colFile).setValue(file.getUrl());
       
       // Soft Delete File Lama
       if (oldUrl && oldUrl.length > 10) {
         try { DriveApp.getFileById(oldUrl.match(/[-\w]{25,}/)[0]).setTrashed(true); } catch(e){}
       }
    }

    sheet.getRange(rowIdx, getColIdx("Nomor SK")).setValue(form.nomorSK);
    if(form.tanggalSK) { 
       var p = form.tanggalSK.split('-'); 
       if(p.length===3) sheet.getRange(rowIdx, getColIdx("Tanggal SK")).setValue(p[2]+'/'+p[1]+'/'+p[0]);
    }

    var stCol = getColIdx("Status");
    var oldSt = sheet.getRange(rowIdx, stCol).getValue();
    if(oldSt == 'Revisi' || oldSt == 'Ditolak') sheet.getRange(rowIdx, stCol).setValue('Diproses');

    sheet.getRange(rowIdx, getColIdx("Update")).setValue(new Date());
    sheet.getRange(rowIdx, getColIdx("User Update")).setValue(form.userUpdate);

    return "Data berhasil diperbarui.";
  } catch(e) { return "Error: " + e.message; }
}

// D. PROSES HAPUS SK
function processDeleteSK(form) {
  try {
    var ss = SpreadsheetApp.openById(SPREADSHEET_IDS.SK_DATA);
    var sheetSource = ss.getSheetByName("Unggah_SK");
    var sheetTrash = ss.getSheetByName("Trash_SK");
    if(!sheetTrash) sheetTrash = ss.insertSheet("Trash_SK");

    var rowIdx = parseInt(form.rowIndex) + 1;
    var rowData = sheetSource.getRange(rowIdx, 1, 1, sheetSource.getLastColumn()).getValues()[0];

    rowData.push("Dihapus: " + form.userDelete + ", Alasan: " + form.alasan);
    sheetTrash.appendRow(rowData);
    sheetSource.deleteRow(rowIdx);

    return "Data dipindahkan ke Trash.";
  } catch(e) { return "Error: " + e.message; }
}

// E. PROSES VERIFIKASI
function processVerifySK(form) {
  try {
    var ss = SpreadsheetApp.openById(SPREADSHEET_IDS.SK_DATA);
    var sheet = ss.getSheetByName("Unggah_SK");
    var rowIdx = parseInt(form.rowIndex) + 1;

    function getColIdx(name) { 
       var h = sheet.getRange(1, 1, 1, sheet.getLastColumn()).getValues()[0];
       var i = h.indexOf(name);
       if(i<0 && name=="Keterangan") i = h.indexOf("Catatan");
       return i+1; 
    }

    sheet.getRange(rowIdx, getColIdx("Status")).setValue(form.statusVerif);
    sheet.getRange(rowIdx, getColIdx("Keterangan")).setValue(form.keterangan);
    sheet.getRange(rowIdx, getColIdx("Verval")).setValue(new Date());
    sheet.getRange(rowIdx, getColIdx("Verifikator")).setValue(form.verifikator);

    return "Verifikasi disimpan.";
  } catch(e) { return "Error: " + e.message; }
}

// Data Dashboard (Placeholder)
function getStatistikPTK() {
  return { total: "156", pns: "85", pppk: "40", honor: "31" };
}


/**
 * ===================================================================
 * ==================== MODUL DATA LAPORAN BULAN =====================
 * ===================================================================
 */



const PAUD_FORM_INDEX_MAP = [
    // 0-7: Data Lembaga (A-H)
    'Tanggal Unggah', 'Bulan', 'Tahun', 'NPSN', 'Status', 'Jumlah Rombel', 'Jenjang', 'Nama Sekolah', 
    
    // 8-21: Murid Usia (L/P)
    'murid_0_1_L', 'murid_0_1_P', 'murid_1_2_L', 'murid_1_2_P', 'murid_2_3_L', 'murid_2_3_P', 
    'murid_3_4_L', 'murid_3_4_P', 'murid_4_5_L', 'murid_4_5_P', 'murid_5_6_L', 'murid_5_6_P', 
    'murid_6_up_L', 'murid_6_up_P',
    
    // 22-25: Murid Rombel (L/P)
    'kelompok_A_L', 'kelompok_A_P', 'kelompok_B_L', 'kelompok_B_P', 

    // 26-29: PTK Kepsek/Guru
    'kepsek_ASN', 'kepsek_Non_ASN', 'guru_PNS', 'guru_PPPK', 'guru_GTY', 'guru_GTT',
    
    // 30-33: PTK Tendik
    'tendik_Penjaga', 'tendik_TAS', 'tendik_Pustakawan', 'tendik_Lainnya',
    
    'Dokumen', // Kolom Dokumen (Indeks 34)
    'Update' // Kolom Update (Indeks 35)
    // Catatan: Asumsi mapping ini sesuai dengan kolom Spreadsheet PAUD Anda.
];

const SD_FORM_INDEX_MAP = [
  // 0-7: Data Sekolah (A-H)
  'Tanggal Unggah', 'Bulan', 'Tahun', 'Status', 'Nama Sekolah', 'NPSN', 'Rombel', 'Dokumen',
  
  // 8-29: Kelas 1 (I-AC)
  'k1_jumlah_rombel', 'k1_rombel_tunggal_L', 'k1_rombel_tunggal_P',
  'k1_rombel_a_L', 'k1_rombel_a_P', 'k1_rombel_b_L', 'k1_rombel_b_P', 'k1_rombel_c_L', 'k1_rombel_c_P',
  'k1_agama_islam_L', 'k1_agama_islam_P', 'k1_agama_kristen_L', 'k1_agama_kristen_P', 'k1_agama_katolik_L', 'k1_agama_katolik_P', 
  'k1_agama_hindu_L', 'k1_agama_hindu_P', 'k1_agama_buddha_L', 'k1_agama_buddha_P', 'k1_agama_konghucu_L', 'k1_agama_konghucu_P',
  
  // 30-51: Kelas 2 (AD-AX)
  'k2_jumlah_rombel', 'k2_rombel_tunggal_L', 'k2_rombel_tunggal_P',
  'k2_rombel_a_L', 'k2_rombel_a_P', 'k2_rombel_b_L', 'k2_rombel_b_P', 'k2_rombel_c_L', 'k2_rombel_c_P',
  'k2_agama_islam_L', 'k2_agama_islam_P', 'k2_agama_kristen_L', 'k2_agama_kristen_P', 'k2_agama_katolik_L', 'k2_agama_katolik_P', 
  'k2_agama_hindu_L', 'k2_agama_hindu_P', 'k2_agama_buddha_L', 'k2_agama_buddha_P', 'k2_agama_konghucu_L', 'k2_agama_konghucu_P',

  // 52-73: Kelas 3 (AY-BS)
  'k3_jumlah_rombel', 'k3_rombel_tunggal_L', 'k3_rombel_tunggal_P',
  'k3_rombel_a_L', 'k3_rombel_a_P', 'k3_rombel_b_L', 'k3_rombel_b_P', 'k3_rombel_c_L', 'k3_rombel_c_P',
  'k3_agama_islam_L', 'k3_agama_islam_P', 'k3_agama_kristen_L', 'k3_agama_kristen_P', 'k3_agama_katolik_L', 'k3_agama_katolik_P', 
  'k3_agama_hindu_L', 'k3_agama_hindu_P', 'k3_agama_buddha_L', 'k3_agama_buddha_P', 'k3_agama_konghucu_L', 'k3_agama_konghucu_P',
  
  // 74-95: Kelas 4 (BT-CN)
  'k4_jumlah_rombel', 'k4_rombel_tunggal_L', 'k4_rombel_tunggal_P',
  'k4_rombel_a_L', 'k4_rombel_a_P', 'k4_rombel_b_L', 'k4_rombel_b_P', 'k4_rombel_c_L', 'k4_rombel_c_P',
  'k4_agama_islam_L', 'k4_agama_islam_P', 'k4_agama_kristen_L', 'k4_agama_kristen_P', 'k4_agama_katolik_L', 'k4_agama_katolik_P', 
  'k4_agama_hindu_L', 'k4_agama_hindu_P', 'k4_agama_buddha_L', 'k4_agama_buddha_P', 'k4_agama_konghucu_L', 'k4_agama_konghucu_P',

  // 96-117: Kelas 5 (CO-DI)
  'k5_jumlah_rombel', 'k5_rombel_tunggal_L', 'k5_rombel_tunggal_P',
  'k5_rombel_a_L', 'k5_rombel_a_P', 'k5_rombel_b_L', 'k5_rombel_b_P', 'k5_rombel_c_L', 'k5_rombel_c_P',
  'k5_agama_islam_L', 'k5_agama_islam_P', 'k5_agama_kristen_L', 'k5_agama_kristen_P', 'k5_agama_katolik_L', 'k5_agama_katolik_P', 
  'k5_agama_hindu_L', 'k5_agama_hindu_P', 'k5_agama_buddha_L', 'k5_agama_buddha_P', 'k5_agama_konghucu_L', 'k5_agama_konghucu_P',

  // 118-139: Kelas 6 (DJ-ED)
  'k6_jumlah_rombel', 'k6_rombel_tunggal_L', 'k6_rombel_tunggal_P',
  'k6_rombel_a_L', 'k6_rombel_a_P', 'k6_rombel_b_L', 'k6_rombel_b_P', 'k6_rombel_c_L', 'k6_rombel_c_P',
  'k6_agama_islam_L', 'k6_agama_islam_P', 'k6_agama_kristen_L', 'k6_agama_kristen_P', 'k6_agama_katolik_L', 'k6_agama_katolik_P', 
  'k6_agama_hindu_L', 'k6_agama_hindu_P', 'k6_agama_buddha_L', 'k6_agama_buddha_P', 'k6_agama_konghucu_L', 'k6_agama_konghucu_P',

  // --- INI ADALAH "PETA DATA" BARU (83 KOLOM PTK) ---
  // 140-142: Kepsek (3)
  'ptk_kepsek_pns', 'ptk_kepsek_pppk', 'ptk_kepsek_nonasn',
  
  // 143-147: Guru Kelas (5)
  'ptk_guru_kelas_pns', 'ptk_guru_kelas_pppk', 'ptk_guru_kelas_pppkpw', 'ptk_guru_kelas_gty', 'ptk_guru_kelas_gtt',
  // 148-152: Guru PAI (5)
  'ptk_guru_pai_pns', 'ptk_guru_pai_pppk', 'ptk_guru_pai_pppkpw', 'ptk_guru_pai_gty', 'ptk_guru_pai_gtt',
  // 153-157: Guru PJOK (5)
  'ptk_guru_pjok_pns', 'ptk_guru_pjok_pppk', 'ptk_guru_pjok_pppkpw', 'ptk_guru_pjok_gty', 'ptk_guru_pjok_gtt',
  // 158-162: Guru PA Kristen (5)
  'ptk_guru_kristen_pns', 'ptk_guru_kristen_pppk', 'ptk_guru_kristen_pppkpw', 'ptk_guru_kristen_gty', 'ptk_guru_kristen_gtt',
  // 163-167: Guru PA Katolik (5)
  'ptk_guru_katolik_pns', 'ptk_guru_katolik_pppk', 'ptk_guru_katolik_pppkpw', 'ptk_guru_katolik_gty', 'ptk_guru_katolik_gtt',
  // 168-172: Guru Bhs. Inggris (5)
  'ptk_guru_inggris_pns', 'ptk_guru_inggris_pppk', 'ptk_guru_inggris_pppkpw', 'ptk_guru_inggris_gty', 'ptk_guru_inggris_gtt',
  // 173-177: Guru Mapel Lain (5)
  'ptk_guru_lainnya_pns', 'ptk_guru_lainnya_pppk', 'ptk_guru_lainnya_pppkpw', 'ptk_guru_lainnya_gty', 'ptk_guru_lainnya_gtt',
  
  // 178-182: Tendik: Pengelola Umum (5)
  'ptk_tendik_pengelola_umum_pns', 'ptk_tendik_pengelola_umum_pppk', 'ptk_tendik_pengelola_umum_pppkpw', 'ptk_tendik_pengelola_umum_pty', 'ptk_tendik_pengelola_umum_ptt',
  // 183-187: Tendik: Operator (5)
  'ptk_tendik_operator_pns', 'ptk_tendik_operator_pppk', 'ptk_tendik_operator_pppkpw', 'ptk_tendik_operator_pty', 'ptk_tendik_operator_ptt',
  // 188-192: Tendik: Pengelola Layanan (5)
  'ptk_tendik_pengelola_layanan_pns', 'ptk_tendik_pengelola_layanan_pppk', 'ptk_tendik_pengelola_layanan_pppkpw', 'ptk_tendik_pengelola_layanan_pty', 'ptk_tendik_pengelola_layanan_ptt',
  // 193-197: Tendik: Penata (5)
  'ptk_tendik_penata_pns', 'ptk_tendik_penata_pppk', 'ptk_tendik_penata_pppkpw', 'ptk_tendik_penata_pty', 'ptk_tendik_penata_ptt',
  // 198-202: Tendik: Adm Perkantoran (5)
  'ptk_tendik_adm_pns', 'ptk_tendik_adm_pppk', 'ptk_tendik_adm_pppkpw', 'ptk_tendik_adm_pty', 'ptk_tendik_adm_ptt',
  // 203-207: Tendik: Penjaga (5)
  'ptk_tendik_penjaga_pns', 'ptk_tendik_penjaga_pppk', 'ptk_tendik_penjaga_pppkpw', 'ptk_tendik_penjaga_pty', 'ptk_tendik_penjaga_ptt',
  // 208-212: Tendik: TAS (5)
  'ptk_tendik_tas_pns', 'ptk_tendik_tas_pppk', 'ptk_tendik_tas_pppkpw', 'ptk_tendik_tas_pty', 'ptk_tendik_tas_ptt',
  // 213-217: Tendik: Pustakawan (5)
  'ptk_tendik_pustakawan_pns', 'ptk_tendik_pustakawan_pppk', 'ptk_tendik_pustakawan_pppkpw', 'ptk_tendik_pustakawan_pty', 'ptk_tendik_pustakawan_ptt',
  // 218-222: Tendik: Lainnya (5)
  'ptk_tendik_lainnya_pns', 'ptk_tendik_lainnya_pppk', 'ptk_tendik_lainnya_pppkpw', 'ptk_tendik_lainnya_pty', 'ptk_tendik_lainnya_ptt',

  // 223: Jenjang
  'Jenjang',
  // 224: Update
  'Update'
];
